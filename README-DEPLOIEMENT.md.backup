# üöÄ Guide de D√©ploiement Complet - Timepulse V2.8.0

> **Status** : ‚úÖ PR√äT POUR PRODUCTION  
> **Date** : 30 Novembre 2025  
> **Build** : ‚úÖ Compil√© sans erreur

---

## ‚ö° D√©marrage Ultra-Rapide (1 commande)

### Sur Windows
```cmd
deploy-complete.bat
```

### Sur Linux/Mac
```bash
./deploy-complete.sh
```

**C'est tout !** Le script s'occupe de :
1. ‚úÖ V√©rifier le build
2. ‚úÖ Commit + Push GitHub
3. ‚úÖ D√©ploiement Vercel Production

---

## üì¶ Fichiers cr√©√©s pour vous

| Fichier | Description |
|---------|-------------|
| `deploy-complete.sh` | Script auto d√©ploiement (Linux/Mac) |
| `deploy-complete.bat` | Script auto d√©ploiement (Windows) |
| `DEPLOY-NOW.md` | Commandes rapides de d√©ploiement |
| `BACKUP-REPORT-2025-11-30.md` | Rapport complet des modifications |
| `SUPABASE-BACKUP-GUIDE.md` | Guide de sauvegarde base de donn√©es |
| `CART-RESERVATION-IMPLEMENTATION-GUIDE.md` | Documentation technique syst√®me r√©servation |
| `LANCEMENT-DEPLOIEMENT.txt` | R√©capitulatif ASCII |

---

## üéØ Nouveaut√©s de cette version

### ‚ú® Fonctionnalit√©s ajout√©es

1. **Syst√®me de r√©servation de places**
   - Places r√©serv√©es lors de l'ajout au panier
   - Compteurs temps r√©el (confirm√©es + r√©serv√©es)
   - Protection contre la survente

2. **File d'attente intelligente**
   - Modal compl√®te avec position dans la file
   - Calcul temps d'attente estim√©
   - Newsletter bourse aux dossards int√©gr√©e

3. **Nettoyage automatique**
   - Job cron toutes les minutes
   - Expire les paniers apr√®s 10 min
   - Prolongation automatique si utilisateur actif

### üêõ Corrections

- ‚úÖ Frais de service n'√©taient plus en double
- ‚úÖ Libell√© "Montant total inscription(s) et option(s)"

---

## üóÑÔ∏è Base de donn√©es Supabase

### Migrations appliqu√©es (2 nouvelles)

```sql
‚úÖ create_cart_cleanup_cron_job
‚úÖ create_cart_reservation_and_waitlist_system_v2
```

### Modifications

**Table `races` :**
- `reserved_spots` : Places r√©serv√©es dans paniers
- `confirmed_entries` : Places pay√©es
- `has_quota` : Quota activ√© ou non

**Table `race_options` :**
- `reserved_quantity` : Quantit√© r√©serv√©e
- `confirmed_quantity` : Quantit√© confirm√©e

**Table cr√©√©e :**
- `race_waitlist` : File d'attente compl√®te

**Fonctions cr√©√©es :**
- `check_race_availability()`
- `reserve_cart_spots()`
- `release_cart_spots()`
- `add_to_waitlist()`
- `notify_next_in_waitlist()`
- `calculate_wait_time()`

**Job cron :**
- `cleanup-expired-carts` : Toutes les minutes

---

## üé¨ Proc√©dure manuelle (si n√©cessaire)

### 1. V√©rifier le build
```bash
npm run build
```

### 2. GitHub
```bash
git add .
git commit -m "feat: Syst√®me de r√©servation et file d'attente + Fix frais de service"
git push origin main
```

### 3. Vercel
```bash
npm run deploy
```

---

## ‚úÖ V√©rifications post-d√©ploiement

### Site accessible
```bash
curl -I https://timepulse.fr
```

### Job cron actif
```sql
SELECT * FROM cron.job;

SELECT * FROM cron.job_run_details
ORDER BY start_time DESC
LIMIT 5;
```

### Places disponibles
```sql
SELECT
  name,
  max_participants,
  confirmed_entries,
  reserved_spots,
  (max_participants - confirmed_entries - reserved_spots) as places_disponibles
FROM races
WHERE has_quota = true;
```

---

## ‚öôÔ∏è Configuration

### Activer les quotas sur une course

```sql
UPDATE races
SET
  has_quota = true,
  max_participants = 500
WHERE id = 'uuid-de-la-course';
```

---

## üìö Documentation

- **D√©marrage rapide** : `DEPLOY-NOW.md`
- **Rapport complet** : `BACKUP-REPORT-2025-11-30.md`
- **Sauvegarde Supabase** : `SUPABASE-BACKUP-GUIDE.md`
- **Guide technique** : `CART-RESERVATION-IMPLEMENTATION-GUIDE.md`

---

## üÜò Aide

### Le build √©choue
```bash
rm -rf node_modules dist
npm install
npm run build
```

### Push GitHub √©choue
```bash
git pull origin main
# R√©soudre conflits si n√©cessaire
git push origin main
```

### Vercel √©choue
```bash
vercel login
vercel --prod --yes
```

---

## üéâ C'est parti !

**Temps estim√©** : 3-5 minutes  
**URL finale** : https://timepulse.fr

```bash
# Windows
deploy-complete.bat

# Linux/Mac
./deploy-complete.sh
```

---

**Version** : 2.8.0 | **Build** : ‚úÖ | **Ready** : ‚úÖ
