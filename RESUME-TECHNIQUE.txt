â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    RÃ‰SUMÃ‰ TECHNIQUE - MIGRATIONS SUPABASE                     â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“… Date: 2025-11-19
ğŸ¯ Objectif: Initialiser la base de donnÃ©es de production Timepulse

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PROBLÃˆME IDENTIFIÃ‰                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. Base de donnÃ©es de production VIDE (aucune table)
2. Erreur: "la relation Â« events Â» n'existe pas"
3. Erreur: "Supabase is not defined" dans EventCharacteristicsFilter.tsx
4. Admin avec rÃ´le 'user' a accÃ¨s Ã  tout (35 permissions)
5. Politiques RLS manquantes pour les admins

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SOLUTIONS APPORTÃ‰ES                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ… 1. Fichier SQL combinÃ© crÃ©Ã©
   ğŸ“„ combined-migrations.sql (190 KB)
   â†’ Contient 26 migrations dans l'ordre chronologique
   â†’ PrÃªt Ã  copier-coller dans Supabase SQL Editor

âœ… 2. Interface web HTML crÃ©Ã©e
   ğŸŒ apply-migrations.html
   â†’ Interface visuelle simple
   â†’ Bouton "Copier le SQL"
   â†’ Lien direct vers Supabase

âœ… 3. Script de gÃ©nÃ©ration
   ğŸ”§ combine-migrations.js
   â†’ RÃ©gÃ©nÃ¨re combined-migrations.sql
   â†’ Personnalisable

âœ… 4. Documentation complÃ¨te
   ğŸ“š START-HERE.md (guide rapide)
   ğŸ“š MIGRATIONS-MODE-EMPLOI.md (guide dÃ©taillÃ©)
   ğŸ“š QUICKSTART-MIGRATIONS.md (version condensÃ©e)

âœ… 5. Build corrigÃ©
   ğŸ—ï¸ npm run build rÃ©ussi
   â†’ Corrige l'erreur "Supabase is not defined"

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MIGRATIONS INCLUSES (26)                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[01] 20251014201249_create_timepulse_schema.sql
     â†’ Tables de base: events, races, organizers, registrations

[02] 20251014205617_create_admin_users_fixed.sql
     â†’ Table admin_users

[03] 20251014205715_add_update_password_function.sql
     â†’ Fonction de mise Ã  jour mot de passe

[04] 20251014210000_create_organizer_module.sql
     â†’ Module organisateurs complet

[05] 20251015070040_create_license_types.sql
     â†’ Types de licences (FFA, FFTri)

[06] 20251015070105_create_pricing_periods.sql
     â†’ PÃ©riodes de tarification

[07] 20251015070131_create_race_pricing.sql
     â†’ Tarification des courses

[08] 20251015070340_create_audit_logs.sql
     â†’ Logs d'audit

[09] 20251017055730_create_entries_module_v2.sql
     â†’ Module inscriptions (entries)

[10] 20251021165340_create_race_category_restrictions.sql
     â†’ Restrictions par catÃ©gorie

[11] 20251021204147_create_carpooling_module.sql
     â†’ Module covoiturage

[12] 20251022085319_create_bib_exchange_module_v3.sql
     â†’ Ã‰change de dossards

[13] 20251022130000_create_email_logs.sql
     â†’ Logs emails

[14] 20251023140000_create_results_module.sql
     â†’ Module rÃ©sultats

[15] 20251024145052_create_payment_transactions_table.sql
     â†’ Transactions paiement

[16] 20251027115516_create_column_mappings_table.sql
     â†’ Mappages colonnes import

[17] 20251028063650_create_email_templates_table.sql
     â†’ Templates emails

[18] 20251101143601_create_athlete_ecosystem_v2.sql
     â†’ Ã‰cosystÃ¨me athlÃ¨tes complet

[19] 20251103161512_create_volunteer_management_fixed.sql
     â†’ Gestion bÃ©nÃ©voles

[20] 20251108160639_create_footer_settings.sql
     â†’ ParamÃ¨tres footer

[21] 20251108162017_create_static_pages.sql
     â†’ Pages statiques

[22] 20251108170000_create_videos_table.sql
     â†’ Table vidÃ©os

[23] 20251113213448_create_event_characteristics.sql
     â†’ CaractÃ©ristiques Ã©vÃ©nements

[24] 20251118000001_create_speaker_module.sql
     â†’ Module speaker

[25] 20251119055900_fix_pgcrypto_and_reset_password.sql
     â†’ Extension pgcrypto

[26] 20251119100000_add_admin_rls_policies_for_supabase_auth.sql
     â†’ Politiques RLS pour admins â­

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MARCHE Ã€ SUIVRE                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Ã‰TAPE 1: Appliquer les migrations
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
MÃ©thode A (recommandÃ©e):
  1. Ouvrir apply-migrations.html dans un navigateur
  2. Cliquer "Charger les migrations"
  3. Cliquer "Copier le SQL"
  4. Cliquer "Ouvrir SQL Editor"
  5. Coller et cliquer "Run"

MÃ©thode B (manuelle):
  1. Ouvrir combined-migrations.sql
  2. Copier TOUT le contenu (Ctrl+A, Ctrl+C)
  3. Aller sur: https://supabase.com/dashboard/project/fgstscztsighabpzzzix/sql/new
  4. Coller (Ctrl+V)
  5. Cliquer "Run"
  6. Attendre 1-2 minutes

Ã‰TAPE 2: DÃ©ployer le nouveau build
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  â†’ Utiliser le bouton "MAJ DU SITE"
  â†’ DÃ©ploie le build qui corrige l'erreur Supabase

Ã‰TAPE 3: Tester l'application
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  1. Connexion admin
  2. VÃ©rifier badge "ADMIN" visible
  3. CrÃ©er/modifier un Ã©vÃ©nement
  4. Ajouter des caractÃ©ristiques

Ã‰TAPE 4: GÃ©rer les permissions
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  1. Connexion super admin
  2. Administration â†’ Utilisateurs Admin
  3. Modifier permissions de l'admin test
  4. Retirer accÃ¨s Finance si nÃ©cessaire

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TABLES CRÃ‰Ã‰ES (30+)                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Core:
  â€¢ events                    â€¢ races                     â€¢ organizers
  â€¢ entries                   â€¢ registrations             â€¢ athletes
  â€¢ results                   â€¢ admin_users               â€¢ profiles

Features:
  â€¢ carpooling_offers         â€¢ carpooling_bookings
  â€¢ bib_exchange_listings     â€¢ bib_exchange_alerts
  â€¢ volunteers                â€¢ volunteer_posts
  â€¢ speakers                  â€¢ speaker_notes

Configuration:
  â€¢ race_pricing              â€¢ race_options
  â€¢ race_categories           â€¢ race_category_restrictions
  â€¢ license_types             â€¢ pricing_periods
  â€¢ invitations               â€¢ promo_codes

Content:
  â€¢ email_templates           â€¢ email_logs
  â€¢ static_pages              â€¢ service_pages
  â€¢ footer_settings           â€¢ videos

Characteristics:
  â€¢ event_characteristic_types
  â€¢ event_characteristics

System:
  â€¢ audit_logs                â€¢ payment_transactions
  â€¢ column_mappings           â€¢ backups
  â€¢ settings

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ VÃ‰RIFICATION POST-MIGRATION                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ExÃ©cuter dans SQL Editor:

  SELECT COUNT(*) as nombre_de_tables
  FROM information_schema.tables
  WHERE table_schema = 'public';

RÃ©sultat attendu: >= 30 tables

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ERREURS COURANTES (NORMALES)                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ“ "relation already exists"        â†’ Normal, table existe dÃ©jÃ 
âœ“ "function already exists"        â†’ Normal, fonction existe dÃ©jÃ 
âœ“ "duplicate key value"            â†’ Normal, donnÃ©es existent
âœ“ "constraint already exists"      â†’ Normal, contrainte existe dÃ©jÃ 

âœ— "permission denied"              â†’ ProblÃ¨me de droits
âœ— "syntax error"                   â†’ Erreur SQL Ã  corriger
âœ— "column does not exist"          â†’ Migration manquante ou ordre incorrect

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RÃ‰SULTAT FINAL                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

AprÃ¨s application:

  âœ… Base de donnÃ©es complÃ¨tement initialisÃ©e
  âœ… 30+ tables crÃ©Ã©es
  âœ… Politiques RLS configurÃ©es
  âœ… Badge admin visible
  âœ… Modification Ã©vÃ©nements possible
  âœ… CaractÃ©ristiques opÃ©rationnelles
  âœ… Permissions admin configurables
  âœ… Application prÃªte pour production

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FICHIERS IMPORTANTS                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Ã€ utiliser maintenant:
  ğŸ“„ START-HERE.md                  â†’ COMMENCER ICI
  ğŸŒ apply-migrations.html          â†’ Interface visuelle
  ğŸ“„ combined-migrations.sql        â†’ SQL Ã  copier-coller

Documentation:
  ğŸ“š MIGRATIONS-MODE-EMPLOI.md      â†’ Guide complet
  ğŸ“š QUICKSTART-MIGRATIONS.md       â†’ Guide rapide
  ğŸ“„ RESUME-TECHNIQUE.txt           â†’ Ce fichier

Scripts:
  ğŸ”§ combine-migrations.js          â†’ RÃ©gÃ©nÃ©rer le SQL combinÃ©
  ğŸ”§ apply-migrations.js            â†’ Script Node.js (informatif)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SUPPORT                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

En cas de problÃ¨me:
  1. Lire MIGRATIONS-MODE-EMPLOI.md (section troubleshooting)
  2. VÃ©rifier les logs Supabase (Dashboard â†’ Logs)
  3. Noter le nom de la migration qui Ã©choue
  4. Copier le message d'erreur exact
  5. Contacter le support technique

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                           BONNE CHANCE ! ğŸš€                                   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
